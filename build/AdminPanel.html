<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; padding: 10px; }
      button {
        margin: 5px 0;
        padding: 8px 12px;
        width: 100%;
        border-radius: 4px;
        border: 1px solid #ccc;
        background:#f5f5f5;
        cursor:pointer;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      h3 { margin-bottom: 5px; }

      #status { margin-top:10px; font-size:14px; color:#333; }

      /* simple spinner */
      .spinner {
        display:none;
        width:16px;
        height:16px;
        border:2px solid #ccc;
        border-top-color:#4285f4;
        border-radius:50%;
        animation: spin 0.8s linear infinite;
        margin-right:6px;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .status-row {
        display:flex;
        align-items:center;
        margin-top:10px;
      }
    </style>
  </head>
  <body>
    <h3>Slack Admin Panel</h3>
    <button onclick="runFunction('syncPeopleDirectory')">Sync People Directory</button>
    <button onclick="runFunction('regenerateUsergroups')">Regenerate Usergroups Sheet</button>
    <button onclick="runFunction('runSyncUsergroups')">Sync All Usergroups</button>
    <button onclick="runFunction('testSyncNotionJson')">Notion json people directory</button>
    <button onclick="runFunction('makeDeactivatedUsersSheet')">Deactivated User Sheet</button>

    <div class="status-row">
      <div class="spinner" id="spinner"></div>
      <div id="status"; style="color: green;"></div>
    </div>

    <script>
      function setButtonsDisabled(disabled) {
        document.querySelectorAll('button').forEach(btn => {
          btn.disabled = disabled;
        });
      }

      function runFunction(funcName) {
        const statusEl = document.getElementById('status');
        const spinner = document.getElementById('spinner');

        // show spinner + disable all buttons
        statusEl.textContent = 'Running ' + funcName + 'â€¦ please wait';
        spinner.style.display = 'inline-block';
        setButtonsDisabled(true);

        google.script.run
          .withSuccessHandler(function(res){
            spinner.style.display = 'none';
            setButtonsDisabled(false);
            statusEl.textContent = funcName + ' finished successfully.';
          })
          .withFailureHandler(function(err){
            spinner.style.display = 'none';
            setButtonsDisabled(false);
            statusEl.textContent = 'Error in ' + funcName + ': ' + err.message;
          })[funcName]();
      }
    </script>
  </body>
</html>
